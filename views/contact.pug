doctype html
html
  head
    title Contacts
  body
    h1 Contacts
    p This is the contact view.
    a(href="/dashboard") Return to Dashboard

    // Export Buttons
    div
      button(onclick="window.location.href='/contacts/export/json'") Export as JSON
      button(onclick="window.location.href='/contacts/export/csv'") Export as CSV
      button(onclick="window.location.href='/contacts/export/excel'") Export as Excel

    // Add Contact Button
    button(onclick="document.getElementById('addContactForm').style.display='block'") Add Contact

    // Add Contact Form
    form#addContactForm(action="/contacts/add" method="post" style="display:none" onsubmit="return validateAddContact()")
      div
        label(for="name") Name:
        input(type="text" name="name")
      div
        label(for="surname") Surname:
        input(type="text" name="surname")
      div
        label(for="phoneNumber") Phone Number:
        input(type="text" name="phoneNumber" id="addPhoneNumber" required)
        span.error-message#addPhoneNumberWarning Please provide a phone number!
      div
        label(for="email") Email:
        input(type="email" name="email")
      div
        label(for="birthday") Birthday:
        input(type="date" name="birthday")
      div
        button(type="submit") Confirm Add
        a(href="/contacts") Cancel Add

    // File Upload Form
    form#uploadForm(action="/contacts/import" method="post" enctype="multipart/form-data")
      div
        label(for="file") Choose File:
        input(type="file" name="file" required)
      div
        button(type="submit") Import

    // Display Contacts
    table
      thead
        tr
          th
          th Name
          th Surname
          th Phone Number
          th Email
          th Birthday
          th Actions
      tbody
        each contact in contacts
          tr
            td
              input(type="checkbox" name="selectedContacts" value=contact.id)
            td= contact.name
            td= contact.surname
            td= contact.phoneNumber
            td= contact.email
            td= contact.birthday ? new Date(contact.birthday).toDateString() : ''
            td
              a(href=`/contacts/edit/${contact.id}`) Edit
              button(onclick=`confirmDelete(${contact.id})`) Delete

    // Add a button to delete selected contacts
    button(onclick="confirmDeleteSelected()") Delete Selected

    script.
      function confirmDelete(contactId) {
        if (confirm('Are you sure you want to delete this contact?')) {
          window.location.href = `/contacts/delete/${contactId}`;
        }
      }

      function confirmDeleteSelected() {
        const selected = Array.from(document.querySelectorAll('input[name="selectedContacts"]:checked'))
          .map(checkbox => checkbox.value);
        if (selected.length === 0) {
          alert('Please select at least one contact to delete.');
          return;
        }
        if (confirm('Are you sure you want to delete the selected contacts?')) {
          fetch('/contacts/delete-multiple', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ ids: selected })
          })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              window.location.reload();
            } else {
              alert('Error deleting contacts');
            }
          })
          .catch(error => console.error('Error:', error));
        }
      }

      function validateAddContact() {
        const phoneNumberInput = document.getElementById('addPhoneNumber');
        const phoneNumberWarning = document.getElementById('addPhoneNumberWarning');
        if (!phoneNumberInput.value) {
          phoneNumberInput.classList.add('error');
          phoneNumberWarning.style.display = 'block';
          return false; // Prevent form submission
        } else {
          phoneNumberInput.classList.remove('error');
          phoneNumberWarning.style.display = 'none';
        }
        return true; // Allow form submission
      } 